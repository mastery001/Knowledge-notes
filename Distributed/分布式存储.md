## 分布式存储策略



### 一致性Hash算法存储

条件：一致性hash算法，数据真实存储机



hash(待处理数据)=存储节点服务器；



适合场景：



- 待存储数据比较小，例如用户在线状态等

- 扩容时数据可能需要迁移



须知：



- 迁移成本低，一致性hash算法的虚拟节点能够保证真实节点较少的情况保证负载均衡，并迁移数据比普通hash算法少的多。具体可查看[一致性hash算法详解](http://www.coin163.com/it/x2881193584320602043/hash-)

- hash算法可在客户端实现，也可服务端实现代理层适配访问。



### 节点状态存储

条件：数据标识算法，数据状态存储机，数据真实存储机



- 数据标识算法：计算待处理数据的索引

- 数据状态存储机：计算数据的索引对应存储在哪台服务器.  

- 数据真实存储机；数据实际存在放哪台服务器



步骤（即Controller来实现下列步骤）：



1. 待处理数据通过`数据标识算法`计算出该数据的`索引标识`；

2. 根据状态机中算出哪台机器负载最低，并得到负载最低的服务器

3. 将`索引标识`与服务器关系存储在状态机，将新数据存储在目标服务器



适合场景：


- 数据占用空间大

- 数据扩容可能性很大，但是做数据迁移却属于灾难性的操作



须知：



- Controller属于核心服务，需要部署，是无状态的，可水平扩容。该服务只能实现好后对外提供。

- 数据无需迁移

- 扩容时需计算好当前集群剩余存储空间，否则新增机器过少则容易出现新增机器负载过高情况




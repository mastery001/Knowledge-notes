# what
解决了什么问题：
1. 单体架构下的单点问题
2. 不可扩展性
带来了什么问题：
1. 数据不一致
2. 更高的维护成本

相关技术点：
- 集群部署、数据同步方式
- CAP理论和BASE理论
- leader选取

# 架构

1. 中心化架构：指定一个中心节点来分发请求、数据等
2. 去中心化架构：所有节点承担同样的职责（基本不存在，区块链是这个思路）；常用的是伪去中心化，如Zookeeper、Etcd等，由集群内自发选举出leader

包含如下几个元素：

1. 节点管理/协调者：持有节点的元信息，流量分发、节点变更处理、主从切换/同步等
    - 有时对应架构中的HA
2. 数据/服务节点：具体存放数据或提供服务的节点


# 集群部署与同步

部署方式：

- 一主多从(单集群)：主为写，从为读
    - mysql
- 双主：双主互为主备，通过VIP访问，只有一台master可写
    - mysql
- 一主多从(多集群)：每个主存放不同的数据，通过`一致性hash`将流量分发到不同的主,HA来保证主挂了能切换到从
    - redis

同步方式：
- 全量同步：slave拉取master全量日志
- 增量同步：slave根据游标拉取master相应游标后的数据

同步交互方式：

1. 推模式（push）：将增量数据发送到slave，**主库需要记录当前的游标**，针对客户端的应答模式有以下几种
    1. 同步后应答：等待所有slave都回复ack后（数据可靠性高，性能低）
    2. 快速同步且应答：有一台slave回复ack后就给客户端回复，如果所有slave在超时时间内都未回复ACK也会给客户端回复（性能中等，数据可靠性中等）
    3. 异步应答：异步给slave发消息（性能高，数据可靠性低）
2. 拉模式（pull）：slave定时向master主动拉数据
    1. 全量拉：全量拉取到master的数据，并将自己的数据替换
    2. 增量拉：master和slave分别保存当前的数据的offser，slave拉取自身offset之后的数据

# Leader选举

- 脑裂：存在两个leader的情况
- 算法：Paxos、Raft


# FYI

- [一文读懂分布式架构知识体系（内含超全核心知识大图）](https://juejin.im/post/5da6b68b51882565f76606fb)
[TOC]

# 特性
（1）低廉价格；
（2）大幅推广；
（3）瞬时售空；
（4）一般是定时上架；
（5）时间短、瞬时并发量高；

# 技术挑战
1. `冲击现有网站`: 独立部署，量大域名也考虑隔离
2. `高并发下的应用、数据库负载`: 页面静态化
3. `网络、带宽增加`: CDN
4. `下单页面`: 下单页面URL动态化
5. `购买按钮点亮`: CDN缓存js，到时间替换js文件内容
6. `订单提交时序`: cookie，最少连接负载算法
7. `下单前置检查`: 全局检查
8. `减库存`: 拍下减库存(而非付款减库存)
9. `超卖`: 乐观锁、尝试扣减库存
10. `秒杀器应对`: 秒杀专用验证码，电视公布验证码，秒杀答题。

# 架构原则
1. 尽量将请求拦截在系统上游
2. 读多写少，多用缓存

# 架构设计
两个阶段：
1. 秒杀之前准备阶段
2. 秒杀开始阶段

## 前端设计
1. 页面展示：cdn
2. 倒计时：定时服务器与客户端同步时间
3. 请求拦截：
    1. 提交按钮置灰
    2. x秒内只能提交一次

## 站点层设计
1. 同一个uid，限制访问频度，页面缓存
2. 同一个item的查询，例如手机车次，页面缓存

## 服务层设计
1. 写请求：请求队列，分段写
2. 读请求：cache

## 数据库设计
- 如何保证数据可用性；
- 如何提高数据库读性能（大部分应用读多写少，读会先成为瓶颈）；
- 如何保证一致性；
- 如何提高扩展性；

# 高并发挑战
1. 请求接口合理设计
2. 处理性能
3. 重启与过载保护

# 防作弊
1. `同一账号多请求`: 记录-cache
2. `多账号多请求`: 
    - 限制ip，容易误伤
    - 验证码机制
3. `多账号不同ip多请求`: 清除僵尸用户

# 超发
1. 悲观锁：每次都加锁；性能差
2. 乐观锁：版本号；CPU计算开销增大
3. FIFO队列：生产快、消费慢；响应变慢

